{% extends 'base.html' %}
{% load staticfiles %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'blog/post_all.css' %}">
{% endblock %}

{% block body %}
    <div class="blog-header">
        <h5>물어보개</h5>
        <p>반려견 산책과 관련된 정보와 후기를 사람들과 자유롭게 공유해보세요!</p>
    </div>

    <div class="blog-container">
        <h6 class="best-post-title">인기 top5 게시글</h6>
        {% for post in sorted %}
        <div class="best-post">
            <div class="best-image">
                <img src="{{post.image.url}}"/>
                <div class="best-info">
                    <h6><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h6>
                    <p>{{ post.modified_at|date:"Y-N-d" }}</p>
                    <p>by. {{ post.owner}}</p>
                    <span><i class="far fa-comment-dots"></i> {{ post.comment_set.all.count }}</span>
                    <span><i class="far fa-heart"></i> {{post.count_likes_user}}</span>
                </div>
            </div>
            
        </div>
        {% endfor %}

        <h6 class="all-post-title">전체글보기</h6>
        <div class="post-search">
            <form class="form-inline my-2 my-lg-0" action="/community/search/" method="POST">{% csrf_token %}
                <input class="form-control mr-sm-2" type="search" placeholder="Global Search" name="search_word" >
            </form>
            <button class="filter">최신순</button>
        </div>

        
            {% for post in posts %}
                {% if post.secret %}
                    {% if request.user == post.owner %}
                    <div class="post-content">
                        <div class="post-text">
                            <span>{{ post.modified_at|date:"Y-N-d" }}</span>
                            <span>by. {{ post.owner}}</span>
                            <h6><a href="{{ post.get_absolute_url }}"><i class="fas fa-lock"></i> {{ post.title }}</a></h6>
                            <span><i class="far fa-comment-dots"></i> {{ post.comment_set.all.count }}</span>
                            <span><i class="far fa-heart"></i> {{post.count_likes_user}}</span>
                        </div>
                        <div class="post-image">
                            <img src="{{post.image.url}}"/>
                        </div>
                    </div>
                    
                    {% else %}
                    <div class="post-content">
                        <div class="post-text">
                            <span>{{ post.modified_at|date:"Y-N-d" }}</span>
                            <span>by. 비공개</span>
                            <h6>비밀글입니다.</a></h6>
                            <span><i class="far fa-comment-dots"></i> 비공개</span>
                            <span><i class="far fa-heart"></i> 비공개</span>
                        </div>
                        <div class="post-image">
                            <i class="fas fa-images"></i>
                        </div>
                    </div>
                    {% endif %}
                {% else %}
                <div class="post-content">
                    <div class="post-text">
                        <span>{{ post.modified_at|date:"Y-N-d" }}</span>
                        <span>by. {{ post.owner}}</span>
                        <h6><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h6>
                        <p>{{post.content}}</p>
                        <span><i class="far fa-comment-dots"></i> {{ post.comment_set.all.count }}</span>
                        <span><i class="far fa-heart"></i> {{post.count_likes_user}}</span>
                    </div>
                    <div class="post-image">
                        <img src="{{post.image.url}}"/>
                    </div>
                </div>
                
                {% endif %}
            {% endfor %}
    </div>
    <br/>
    <button type="button" class="org-btn-sm" onclick="location.href='{% url 'blog:add'%}'; ">생성</button>
    <button type="button" class="org-btn-sm" onclick="location.href='{% url 'accounts:base'%}'; ">메인 홈페이지</button>
    <div>
        <span>
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}">Previous Page</a>
            {% endif %}

            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">NextPage</a>
            {% endif %}
        </span>
    </div>
{% endblock %}
